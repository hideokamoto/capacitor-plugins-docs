{"title":"PaymentFlow","code":[],"scrollActiveLine":[],"hypertext":"<p>With PaymentFlow, you can make payments in two steps flow. And you can use setupIntent.</p>\n<h2 id=\"1.-createpaymentflow\"><a class=\"header-anchor-link\" href=\"#1.-createpaymentflow\" aria-hidden=\"true\" rel=\"nofollow\"></a> 1.  createPaymentFlow</h2>\n<p>You should connect to your backend endpoint, and get every key. This is &quot;not&quot; function at this Plugin. So you can use <code>HTTPClient</code> , <code>Axios</code> , <code>Ajax</code> , and so on.<br>\nBackend structure is here: <a href=\"https://stripe.com/docs/payments/accept-a-payment?platform=ios#add-server-endpoint\" rel=\"nofollow\">https://stripe.com/docs/payments/accept-a-payment?platform=ios#add-server-endpoint</a></p>\n<p>You will need to prepare either paymentIntentClientSecret or setupIntentClientSecret and set it in the method.</p>\n<div class=\"code-block-container\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> PaymentSheetEventsEnum<span class=\"token punctuation\">,</span> Stripe <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@capacitor-community/stripe'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/**\n   * Connect to your backend endpoint, and get every key.\n   */</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> paymentIntent<span class=\"token punctuation\">,</span> ephemeralKey<span class=\"token punctuation\">,</span> customer <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">post</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token punctuation\">{</span>\n    paymentIntent<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n    ephemeralKey<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n    customer<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>environment<span class=\"token punctuation\">.</span>api <span class=\"token operator\">+</span> <span class=\"token string\">'payment-sheet'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">first</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toPromise</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">Promise</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n  Stripe<span class=\"token punctuation\">.</span><span class=\"token function\">createPaymentFlow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    paymentIntentClientSecret<span class=\"token operator\">:</span> paymentIntent<span class=\"token punctuation\">,</span>\n    customerId<span class=\"token operator\">:</span> customer<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// setupIntentClientSecret: setupIntent,</span>\n    <span class=\"token comment\">// merchantDisplayName: 'Your App Name or Company Name',</span>\n    <span class=\"token comment\">// customerEphemeralKeySecret: ephemeralKey,</span>\n    <span class=\"token comment\">// style: 'alwaysDark',</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h2 id=\"2.-presentpaymentflow\"><a class=\"header-anchor-link\" href=\"#2.-presentpaymentflow\" aria-hidden=\"true\" rel=\"nofollow\"></a> 2. presentPaymentFlow</h2>\n<p>present in <code>presentPaymentFlow</code> is not submit method. You need to confirm method.</p>\n<div class=\"code-block-container\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">present</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Stripe<span class=\"token punctuation\">.</span><span class=\"token function\">presentPaymentFlow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// { cardNumber: \"●●●● ●●●● ●●●● ****\" }</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h2 id=\"3.-confirmpaymentflow\"><a class=\"header-anchor-link\" href=\"#3.-confirmpaymentflow\" aria-hidden=\"true\" rel=\"nofollow\"></a> 3. confirmPaymentFlow</h2>\n<div class=\"code-block-container\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">present</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Stripe<span class=\"token punctuation\">.</span><span class=\"token function\">confirmPaymentFlow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>"}